{% extends "base.html" %}
{% set use_plotly = false %}
{% set use_esrileaflet = true %}

{% block head %}
    {{ super() }}
	<link href="static/css/dreport.css" rel="stylesheet" media="screen">
	<script type="text/javascript">
		var __SETTINGS = {{ settings|tojson }};
	</script>
{% endblock %}	

{% block body_content %}
	<!--  raw tells jinja not to parse curly braces so we can angular takes place -->
	{% raw %}
	<div class="main flex v-container">
		<div class="top"></div> <!-- not used, maybe in the future for a top toolbar ... -->
		<div class="center flex h-container">
			<div class="center">
				<div id="map"></div>
			</div>
			<div class="right flex v-container left-panel">
				<div class='center'>
					<div class='section'>
						This map shows the <b>stations data availability (SDA)</b>
						of the database. Each map's shape represents a station,
						and its color its SDA defined as:
						<table class='formula'>
						<tr><td rowspan=2>SDA</td><td rowspan=2>= 1-</td><td style="border-bottom:1px solid #000">number of malformed segments</td></tr>
						<tr><td>total number of segments</td></tr>
						</table>
					</div>
					<div class='section'>
						Malformed segments are those whose download status falls in any of the
						<b>selected</b> categories:
					</div>
					<div class='section'>
						<div class="form-check" ng:repeat="tuple in selLabels">
							<label ng-class="{'disabled': !tuple[2] }" class="form-check-label">
							    <input ng-disabled="!tuple[2]" class="form-check-input" type='checkbox'
							    	ng-change='updateMap()' 
							    	   ng-model='selLabels[$index][1]'/>{{ tuple[0] }} ({{ tuple[2] }})
							</label>
						</div>
					</div>
					<div class='section'>
					Therefore, the definition of SDA is user dependent according to the
					selected categories above (toggling selection will update the map dynamically)
					</div>
					<div class='section'>
					Total number of segments: {{ numSegments }}
					</div>
					<div class='section'>
						Click on each station symbol to have detailed
						information on its SDA
					</div>
					<div class='section'>
						Click on the upper-right button
						(legend) to select the data-centers of
						interest (if more data-centers are found)
					</div>
				</div>
				<div class="bottom">
					<!-- <div class='section'>Malformed segments categories
					(this will recompute each station's SDA
					and update the map):
					</div>
					<div class='section'>
						<div class="form-check" ng:repeat="tuple in selLabels">
							<label ng-class="{'disabled': !tuple[2] }" class="form-check-label">
							    <input ng-disabled="!tuple[2]" class="form-check-input" type='checkbox'
							    	ng-change='updateMap()' 
							    	   ng-model='selLabels[$index][1]'/>{{ tuple[0] }} ({{ tuple[2] }})
							</label>
						</div>
					</div> -->
				</div>
			</div>
		</div>
	</div>
	{% endraw %}
	<script src="static/js/dreport/leafletmap.js" defer></script>
	<script src="static/js/dreport/ng-app.js" defer></script>
{% endblock %}